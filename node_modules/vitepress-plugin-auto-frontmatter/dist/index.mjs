import{createLogger as D,normalizePath as E}from"vite";import{join as R,basename as S,resolve as y,relative as k}from"node:path";import{glob as I}from"tinyglobby";import b from"gray-matter";import{readFileSync as P,statSync as T,writeFileSync as q}from"node:fs";import u from"picocolors";function z(e,t="yyyy-MM-dd hh:mm:ss"){e instanceof Date||(e=new Date(e));const n={"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds(),"q+":Math.floor((e.getMonth()+3)/3),S:e.getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,`${e.getFullYear()}`.substr(4-RegExp.$1.length)));for(const r in n)new RegExp(`(${r})`).test(t)&&(t=t.replace(RegExp.$1,RegExp.$1.length===1?n[r]:`00${n[r]}`.substr(`${n[r]}`.length)));return t}const A="1.0.11",m=D("info",{prefix:`[vitepress-plugin-auto-frontmatter v${A}]`}),H=(e,t="green",n={timestamp:!0})=>{m.info(u[t](e),n)},L=(e,t="yellow",n={timestamp:!0})=>{m.warn(u[t](e),n)},W=(e,t="yellow",n={timestamp:!0})=>{m.info(u[t](e),n)},Y=(e,t="red",n={timestamp:!0})=>{m.error(u[t](e),n)},_={info:H,warn:L,warnOnce:W,error:Y};function B(e={}){let t=!1;return{name:"vitepress-plugin-auto-frontmatter",async config(n){if(t)return;t=!0;let{pattern:r}=e;if(!r)return;const{globOptions:o}=e,{srcDir:c}=n.vitepress;typeof r=="string"&&(r=[r]),r=r.map(s=>E(R(c,s)));const g=await I(r,{expandDirectories:!1,...o,absolute:!0,ignore:["**/node_modules/**","**/dist/**",...o?.ignore||[]]});C(g,e,c)}}}const C=(e,t,n)=>{const{include:r,exclude:o,transform:c,recoverTransform:g=!1}=t;for(const s of e){if(!s.endsWith(".md"))continue;const w=P(s,"utf-8"),{data:i,content:O}=b(w);if(i.layout==="home"||!x(i,{exclude:o,include:r}))continue;let a={...i},p=!1;const d=T(s),M={title:$(S(s)),date:d.birthtime||d.atime};for(const[f,j]of Object.entries(M))i[f]===void 0&&(a={[f]:j,...a},p=!0);const h=c?.(a,v(n,s));if(!p&&!h)continue;const l=h||a;if(l.date=z(a.date),!g&&Object.keys(l).every(f=>i[f]!==void 0))continue;const F=Object.keys(l).length?b.stringify("",l).replace(/'/g,"").replace(/(?:\r?\n)$/,""):"";q(s,`${F}${O}`),_.info(`'${s}' has been successfully written to frontmatter. (\u6210\u529F\u5199\u5165 frontmatter)`)}},x=(e,{exclude:t,include:n})=>{if(n&&!Object.keys(e).length)return!1;if(t||n){for(const[r,o]of Object.entries(e))if(t?.[r]===o||n?.[r]!==o)return!1}return!0},$=e=>{let t="";const n=e.split(".");if(n.length===2)t=n[0];else{const r=e.indexOf("."),o=e.lastIndexOf(".");t=e.substring(r+1,o)}return t},v=(e,t)=>{const n=y(e),r=y(t),o=k(n,r).replace(/\\/g,"/");return{filePath:t,relativePath:o}};export{x as checkExcludeAndInclude,B as default,v as getFileInfo,$ as getMdFileTitle};
